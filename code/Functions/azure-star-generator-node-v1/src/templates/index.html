<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STAR Story Generator - Azure Functions</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --azure-blue: #0078d4;
            --azure-light-blue: #50e6ff;
            --azure-dark-blue: #0046a8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, var(--azure-blue), var(--azure-dark-blue));
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .star-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .star-section {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        
        .star-section h3 {
            color: var(--azure-blue);
            margin-bottom: 10px;
        }
        
        .btn-azure {
            background-color: var(--azure-blue);
            color: white;
            border: none;
            transition: all 0.3s ease;
        }
        
        .btn-azure:hover {
            background-color: var(--azure-dark-blue);
            color: white;
        }
        
        .feedback-input {
            min-height: 150px;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .azure-badge {
            background-color: var(--azure-light-blue);
            color: #333;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-right: 5px;
        }
        
        .result-container {
            display: none;
        }
        
        .copy-btn {
            float: right;
            font-size: 0.9rem;
        }
        
        .file-upload {
            position: relative;
            overflow: hidden;
            margin: 10px 0;
            width: 100%;
        }
        
        .file-upload input[type=file] {
            display: none;
        }
        
        .file-upload-label {
            display: block;
            padding: 10px 15px;
            background: #f8f9fa;
            border: 2px dashed #ccc;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-label:hover {
            background: #e9ecef;
            border-color: var(--azure-blue);
        }
        
        .file-upload-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .csv-info {
            background-color: #f8f9fa;
            border-left: 4px solid var(--azure-blue);
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9rem;
        }
        
        .story-nav {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        
        .story-pagination {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .story-counter {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .accordion-button:not(.collapsed) {
            background-color: rgba(0, 120, 212, 0.1);
            color: var(--azure-blue);
        }
        
        .audience-icon {
            font-size: 1.2rem;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header text-center">
            <h1>STAR Story Generator</h1>
            <p>Craft compelling stories about your professional experiences for any audience</p>

        <div>
                <span class="azure-badge">Azure Functions</span>
                <span class="azure-badge">Professional Storytelling Tool</span>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="star-container">
                    <h2>Why Storytelling Matters in 2025</h2>
                    <ul>
                        <li><strong>For consultants:</strong> Use storytelling to communicate your experiences and impact internally, helping leadership and peers understand your contributions.</li>
                        <li><strong>For client-facing work:</strong> Structure client success stories that showcase how you've solved problems, built relationships, and delivered value.</li>
                        <li><strong>For job seekers in 2025:</strong> Leverage storytelling with AI tools to present your skills and achievements effectively in job searches and interviews.</li>
                    </ul>
                </div>
                
                <div class="star-container">
                    <h2 class="mb-4">Upload Your Feedback</h2>
                    
                    <form id="feedbackForm">
                        <div class="mb-4">
                            <label class="form-label">Upload your feedback CSV file</label>
                            <div class="file-upload">
                                <input type="file" id="csvFile" accept=".csv" required>
                                <label for="csvFile" class="file-upload-label">
                                    <i class="fas fa-cloud-upload-alt"></i> Choose a CSV file or drag it here
                                </label>
                                <div id="fileInfo" class="file-upload-info">No file selected</div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="interactionType" class="form-label">Who are you telling your story to?</label>
                            <select class="form-select" id="interactionType">
                                <optgroup label="Story Collections">
                                    <option value="top10">Generate top 10 STAR stories to prepare</option>
                                    <option value="leadership">Generate stories focused on leadership & management</option>
                                    <option value="technical">Generate stories highlighting technical achievements</option>
                                    <option value="sales">Generate stories showcasing sales and client success</option>
                                </optgroup>
                                <optgroup label="Audience-Focused Stories">
                                    <option value="colleague">Tell a story about yourself to a colleague</option>
                                    <option value="client">Tell a story about yourself to a potential client</option>
                                    <option value="employer">Tell a story about yourself to a potential employer</option>
                                </optgroup>
                                <optgroup label="Custom">
                                    <option value="custom">Create a custom story</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div id="customOptions" class="mb-4" style="display: none;">
                            <label for="customPrompt" class="form-label">Audience and context (optional)</label>
                            <textarea class="form-control" id="customPrompt" rows="3" placeholder="Example: Generate a story for a conference presentation about a time I solved a complex technical challenge..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-azure w-100">Generate Your Stories</button>
                    </form>
                    
                    <div class="loading-spinner" id="loadingSpinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Analyzing your feedback and crafting your stories...</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="star-container" id="csvInfoContainer">
                    <h3>CSV File Format</h3>
                    <p>Your CSV file should include these columns:</p>
                    <ul>
                        <li><strong>Date:</strong> When the feedback was received</li>
                        <li><strong>Source:</strong> Who provided the feedback</li>
                        <li><strong>Name:</strong> Your name or identifier</li>
                        <li><strong>Project / Context:</strong> The project or situation</li>
                        <li><strong>Feedback Type:</strong> Type of feedback (positive/constructive)</li>
                        <li><strong>Tags:</strong> Skills or competencies demonstrated</li>
                        <li><strong>Star Impact (1-5):</strong> Rating of impact</li>
                        <li><strong>Actual Feedback:</strong> The detailed feedback received</li>
                    </ul>
                    <p>This structured format helps create more authentic and impactful stories about your professional experiences.</p>
                </div>
                
                <div class="star-container result-container" id="resultContainer">
                    <h2 class="mb-3">Your Professional Stories</h2>
                    <p class="text-muted" id="audienceLabel">Stories tailored for your chosen audience</p>
                    
                    <div class="story-nav mb-4">
                        <button class="btn btn-sm btn-outline-secondary" id="prevStory">Previous</button>
                        <div class="story-pagination">
                            <span class="story-counter">Story <span id="currentStory">1</span> of <span id="totalStories">5</span></span>
                        </div>
                        <button class="btn btn-sm btn-outline-secondary" id="nextStory">Next</button>
                    </div>
                    
                    <div id="storyContent">
                        <div class="star-section">
                            <h3>Situation</h3>
                            <p id="situationText"></p>
                        </div>
                        
                        <div class="star-section">
                            <h3>Task</h3>
                            <p id="taskText"></p>
                        </div>
                        
                        <div class="star-section">
                            <h3>Action</h3>
                            <p id="actionText"></p>
                        </div>
                        
                        <div class="star-section">
                            <h3>Result</h3>
                            <p id="resultText"></p>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-primary" id="regenerateBtn">Regenerate</button>
                        <button class="btn btn-outline-secondary" id="copyBtn">Copy Story</button>
                    </div>
                </div>
                
                <div class="star-container" id="infoContainer">
                    <h3>About STAR Method for Professional Storytelling</h3>
                    <p>The STAR method helps you structure compelling stories about your work experiences:</p>
                    
                    <div class="accordion" id="starAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                    <strong>S</strong>ituation
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#starAccordion">
                                <div class="accordion-body">
                                    Set the scene by describing the context and background. In today's economic landscape, being able to articulate specific situations clearly helps your audience connect with your experience and understand the challenges you faced.
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                    <strong>T</strong>ask
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#starAccordion">
                                <div class="accordion-body">
                                    Explain your specific responsibilities or objectives. This shows your role clarity and ability to take ownership of problems—qualities highly valued in 2025's dynamic work environment where autonomy and initiative are increasingly important.
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                    <strong>A</strong>ction
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#starAccordion">
                                <div class="accordion-body">
                                    Detail the specific steps you took to address the challenge. Focus on how you demonstrated key skills relevant to your audience, whether they're a colleague interested in collaboration, a client considering your services, or a potential employer assessing your fit.
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                                    <strong>R</strong>esult
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#starAccordion">
                                <div class="accordion-body">
                                    Share the tangible outcomes of your actions. In the current economic climate, emphasizing measurable results and efficiency gains will resonate strongly with all audiences, as organizations continue to prioritize demonstrable value and return on investment.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const feedbackForm = document.getElementById('feedbackForm');
            const csvFileInput = document.getElementById('csvFile');
            const fileInfo = document.getElementById('fileInfo');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const resultContainer = document.getElementById('resultContainer');
            const infoContainer = document.getElementById('infoContainer');
            const csvInfoContainer = document.getElementById('csvInfoContainer');
            const interactionType = document.getElementById('interactionType');
            const customOptions = document.getElementById('customOptions');
            const copyBtn = document.getElementById('copyBtn');
            const regenerateBtn = document.getElementById('regenerateBtn');
            const prevStoryBtn = document.getElementById('prevStory');
            const nextStoryBtn = document.getElementById('nextStory');
            const currentStorySpan = document.getElementById('currentStory');
            const totalStoriesSpan = document.getElementById('totalStories');
            const audienceLabel = document.getElementById('audienceLabel');
            
            // STAR elements
            const situationText = document.getElementById('situationText');
            const taskText = document.getElementById('taskText');
            const actionText = document.getElementById('actionText');
            const resultText = document.getElementById('resultText');
            
            // State variables
            let csvData = null;
            let generatedStories = [];
            let currentStoryIndex = 0;
            
            // Show custom options if the custom option is selected
            interactionType.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customOptions.style.display = 'block';
                } else {
                    customOptions.style.display = 'none';
                }
            });
            
            // Update file info when a file is selected
            csvFileInput.addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name;
                if (fileName) {
                    fileInfo.textContent = fileName;
                    readCSVFile(e.target.files[0]);
                } else {
                    fileInfo.textContent = 'No file selected';
                    csvData = null;
                }
            });
            
            // Read the CSV file
            function readCSVFile(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    csvData = e.target.result;
                    console.log("CSV file loaded successfully");
                };
                reader.onerror = function() {
                    console.error("Error reading file");
                    csvData = null;
                };
                reader.readAsText(file);
            }
            
            // Handle form submission
            feedbackForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!csvData) {
                    alert('Please upload a CSV file first.');
                    return;
                }
                
                // Show loading spinner
                loadingSpinner.style.display = 'block';
                
                // Get interaction type
                const type = interactionType.value;
                const customPrompt = document.getElementById('customPrompt').value;
                
                // Set appropriate audience label
                switch(type) {
                    case 'colleague':
                        audienceLabel.textContent = 'Stories tailored for sharing with colleagues';
                        break;
                    case 'client':
                        audienceLabel.textContent = 'Stories tailored for potential clients';
                        break;
                    case 'employer':
                        audienceLabel.textContent = 'Stories tailored for job interviews and career advancement';
                        break;
                    case 'custom':
                        audienceLabel.textContent = 'Custom stories based on your specifications';
                        break;
                    default:
                        audienceLabel.textContent = 'Stories tailored for your chosen audience';
                }
                
                try {
                    // Call the Azure Function API
                    const response = await fetch(window.location.href, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            csvData: csvData,
                            interactionType: type,
                            customPrompt: customPrompt
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to generate stories');
                    }
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        // Update the UI with the generated STAR stories
                        generatedStories = data.stories;
                        totalStoriesSpan.textContent = generatedStories.length;
                        currentStoryIndex = 0;
                        updateCurrentStoryView();
                        
                        // Hide info container and csv info container, show result container
                        infoContainer.style.display = 'none';
                        csvInfoContainer.style.display = 'none';
                        resultContainer.style.display = 'block';
                    } else {
                        throw new Error(data.error || 'Failed to generate stories');
                    }
                } catch (error) {
                    alert('Error: ' + error.message);
                } finally {
                    // Hide loading spinner
                    loadingSpinner.style.display = 'none';
                }
            });
            
            // Update the current story view
            function updateCurrentStoryView() {
                if (generatedStories.length === 0) return;
                
                const currentStory = generatedStories[currentStoryIndex];
                situationText.textContent = currentStory.situation;
                taskText.textContent = currentStory.task;
                actionText.textContent = currentStory.action;
                resultText.textContent = currentStory.result;
                
                currentStorySpan.textContent = currentStoryIndex + 1;
                
                // Update navigation buttons
                prevStoryBtn.disabled = currentStoryIndex === 0;
                nextStoryBtn.disabled = currentStoryIndex === generatedStories.length - 1;
            }
            
            // Previous story button
            prevStoryBtn.addEventListener('click', function() {
                if (currentStoryIndex > 0) {
                    currentStoryIndex--;
                    updateCurrentStoryView();
                }
            });
            
            // Next story button
            nextStoryBtn.addEventListener('click', function() {
                if (currentStoryIndex < generatedStories.length - 1) {
                    currentStoryIndex++;
                    updateCurrentStoryView();
                }
            });
            
            // Copy functionality
            copyBtn.addEventListener('click', function() {
                if (generatedStories.length === 0) return;
                
                const currentStory = generatedStories[currentStoryIndex];
                const starStory = `SITUATION:
${currentStory.situation}

TASK:
${currentStory.task}

ACTION:
${currentStory.action}

RESULT:
${currentStory.result}`;
                
                navigator.clipboard.writeText(starStory)
                    .then(() => {
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = 'Copied!';
                        setTimeout(() => {
                            copyBtn.textContent = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Could not copy text: ', err);
                    });
            });
            
            // Regenerate button
            regenerateBtn.addEventListener('click', function() {
                if (confirm('This will regenerate all stories. Continue?')) {
                    feedbackForm.dispatchEvent(new Event('submit'));
                }
            });
        });
    </script>
</body>
</html>